const d = document,
  scrollController = new AbortController(),
  navController = new AbortController(),
  cleanup = () => {
    scrollController.abort(), navController.abort();
  };
function lazyLoadBackgroundImages() {
  let e = document.querySelectorAll("[data-setbg]"),
    t = new IntersectionObserver(
      (e, t) => {
        e.forEach((e) => {
          if (e.isIntersecting) {
            let a = e.target,
              r = a.getAttribute("data-setbg");
            (a.style.backgroundImage = `url(../images/${r})`), t.unobserve(a);
          }
        });
      },
      { threshold: 0.1 }
    );
  e.forEach((e) => {
    t.observe(e);
  });
}
function initializeContactForm() {
  let e = d.querySelector("#form-scroll");
  if (e) {
    let t = new IntersectionObserver(
      (e) => {
        e.forEach((e) => {
          e.isIntersecting &&
            !window.grecaptcha &&
            (loadRecaptcha(), t.unobserve(e.target));
        });
      },
      { threshold: 0.01 }
    );
    t.observe(e);
  }
}
function initializeHeroBackground() {
  let e = d.querySelector(".hero-component-bg");
  if (e) {
    let t = e.getAttribute("data-setbg");
    e.style.backgroundImage = `url(../../images/${t})`;
  }
}
function handleScrollToForm() {
  let e = new URLSearchParams(window.location.search);
  if (e.has("message") && ("contacto.php" === page || "contacto" === page)) {
    let t = d.getElementById("form-scroll");
    console.log(t),
      t &&
        ((t.style.scrollMargin = "7rem"),
        t.scrollIntoView({ behavior: "smooth", top: 80 }));
  }
}
function initializeClickioConsent() {
  let e = document.createElement("div");
  document.body.insertBefore(e, document.body.firstChild);
  let t = new MutationObserver((e) => {
    e.forEach((e) => {
      e.addedNodes.length &&
        e.addedNodes.forEach((e) => {
          e.classList &&
            e.classList.contains("cl-consent-node-p") &&
            requestAnimationFrame(() => {
              e.classList.add("loaded");
            });
        });
    });
  });
  t.observe(document.body, { childList: !0, subtree: !0 });
}
d.addEventListener("DOMContentLoaded", () => {
  "use strict";
  let e = d.getElementById("main"),
    t = e ? e.offsetTop : 0,
    a = d.querySelector(".navbar");
  window.addEventListener(
    "scroll",
    () => {
      let e = Math.round(window.scrollY);
      e > t
        ? a.classList.add("past-main", "effect-main")
        : a.classList.remove("past-main");
    },
    { signal: scrollController.signal }
  );
  let r = d.querySelectorAll(".nav-link"),
    l = d.getElementById("navbarCollapse"),
    o = new bootstrap.Collapse(l, { toggle: !1 });
  r.forEach((e) => {
    e.addEventListener(
      "click",
      () => {
        o.hide();
      },
      { signal: navController.signal }
    );
  });
  let n = d.querySelector(".navbar-toggler.collapsed");
  n &&
    n.addEventListener("click", () => {
      a.classList.contains("past-main") || a.classList.add("past-main");
    });
  let s = window.location.pathname.split("/"),
    i = s[s.length - 1],
    c = s[s.length - 2];
  i = i.replace(".php", "");
  let p = "blog" === c || "blog" === i,
    m = d.querySelector('a[href="/blog"]');
  if (p && m) m.classList.add("active-page"), (m.ariaSelected = "true");
  else if ("" !== i && "index" !== i) {
    let g = d.querySelector(`a[href="/${i}.php"]`);
    g && (g.classList.add("active-page"), (g.ariaSelected = "true"));
  }
  let y = d.querySelector(".hero-parallax");
  window.addEventListener("scroll", () => {
    let e = window.scrollY;
    y && (y.style.backgroundPositionY = `${0.5 * e}px`);
  });
  let h = window.location.pathname.split("/");
  if ("politica-de-privacidad.php" === h[h.length - 1]) {
    let f = d.querySelector(".navbar");
    f.style.backgroundColor = "#00909b";
  }
  initBlogMasonry(),
    initializeContactForm(),
    initializeHeroBackground(),
    handleScrollToForm(),
    initializeClickioConsent(),
    lazyLoadBackgroundImages(),
    window.addEventListener("pagehide", cleanup, { once: !0 });
});
const pathName = window.location.pathname.split("/");
let page = pathName[pathName.length - 1];
const galleryItems = [
  {
    type: "large",
    image: "crossfit_arastur_primera_clase.webp",
    category: "Crossfit y Principiantes",
    title: "\xbfC\xf3mo afrontar mi primera clase de crossfit?",
    link: "blog/como-afrontar-primera-clase-de-crossfit.php",
    date: "2/15/2025",
  },
  {
    type: "instagram",
    category: "Gym & Crossfit",
    title:
      "Sigue nuestras clases en Instagram #crosstraining #functionalfitness",
    link: "https://www.instagram.com/crossfitarastur/?hl=en",
    date: "2/15/2025",
  },
  {
    type: "small",
    image: "blog-4.webp",
    category: "Hostoria & Crossfit",
    title: "Or\xedgenes del Crossfit",
    link: "blog/origenes-del-crossfit.php",
    date: "2/15/2025",
  },
  {
    type: "xls-large",
    image: "crossfit-history.webp",
    category: "Crossfit & Nomenclaturas del Crossfit",
    title:
      "WOD, box, AMRAP, Time capâ€¦ \xbfqu\xe9 quieren decir estas palabras?",
    link: "blog/que-son-wod-box-amrap-time-cap.php",
    date: "2/15/2025",
  },
];
let dynamicGallery =
  "blog.php" === page || "blog" === page
    ? galleryItems
    : galleryItems.slice(0, 4);
function createMasonryItems() {
  let e = d.getElementById("masonry-container");
  e &&
    ((e.innerHTML = ""),
    dynamicGallery.forEach((t) => {
      let a = d.createElement("div");
      a.className = "col-lg-4 col-md-6 grid-item masonry-item";
      let r = d.createElement("div");
      (r.className = `blog-item ${t.type}-item`),
        t.image &&
          (r.setAttribute("data-setbg", t.image),
          (r.style.backgroundImage = `../../images/${t.image}`));
      let l = d.createElement("a");
      (l.href = t.link),
        (l.className = "instagram" === t.type ? "instagram-text" : "blog-text"),
        "instagram" === t.type && (l.target = "_blank");
      let o = d.createElement("div");
      if (((o.className = "categories"), "instagram" === t.type)) {
        let n = d.createElement("p");
        (n.textContent = t.category), o.appendChild(n);
        let s = d.createElement("i");
        (s.className = "fa fa-instagram"), o.appendChild(s);
      } else o.textContent = t.category;
      let i = d.createElement("h3");
      (i.textContent = t.title),
        l.appendChild(o),
        l.appendChild(i),
        r.appendChild(l),
        a.appendChild(r),
        e.appendChild(a);
    }));
}
function resizeMasonryItem(e) {
  let t = d.querySelector(".masonry");
  if (!t) return;
  let a = parseInt(
      window.getComputedStyle(t).getPropertyValue("grid-row-gap") || "0"
    ),
    r = parseInt(
      window.getComputedStyle(t).getPropertyValue("grid-auto-rows") || "0"
    ),
    l = e.querySelector(".blog-item");
  if (!l) return;
  let o = Math.ceil((l.getBoundingClientRect().height + a) / (r + a));
  e.style.gridRowEnd = "span " + (o < 8 ? 10 : o);
}
function resizeAllMasonryItems() {
  let e = d.getElementsByClassName("masonry-item");
  for (let t = 0; t < e.length; t++) resizeMasonryItem(e[t]);
}
function initBlogMasonry() {
  d.getElementById("masonry-container") &&
    (createMasonryItems(),
    ["load", "resize"].forEach((e) => {
      window.addEventListener(e, resizeAllMasonryItems, {
        signal: scrollController.signal,
      });
    }),
    setTimeout(resizeAllMasonryItems, 100));
}
const forms = d.querySelectorAll(".needs-validation");
function loadRecaptcha() {
  let e = document.createElement("script");
  (e.src = `https://www.google.com/recaptcha/api.js?render=${RECAPTCHA_PUBLIC}`),
    document.body.appendChild(e),
    (e.onload = function () {
      grecaptcha.ready(function () {
        let e = document.querySelector("#form-scroll");
        e &&
          grecaptcha
            .execute(RECAPTCHA_PUBLIC, { action: "formulario" })
            .then(function (e) {
              let t = document.getElementById("recaptchaResponse");
              t && (t.value = e);
            });
      });
    });
}
Array.from(forms).forEach((e) => {
  e.addEventListener(
    "submit",
    async (t) => {
      if ((t.preventDefault(), !e.checkValidity())) {
        t.stopPropagation(), e.classList.add("was-validated");
        return;
      }
      try {
        if ("undefined" == typeof grecaptcha)
          throw Error(
            "reCAPTCHA no est\xe1 cargado. Por favor, actualice la p\xe1gina."
          );
        let a = await grecaptcha.execute(
            "6Lehe90qAAAAAPEWmVnvUJSDBVOK3j4EfIyNyBjK",
            { action: "formulario" }
          ),
          r = new FormData(e);
        r.append("recaptcha_response", a);
        let l = await fetch("proceso-contacto.php", {
          method: "POST",
          body: r,
        });
        if (!l.ok) throw Error(`HTTP error! status: ${l.status}`);
        let o = await l.json();
        if (o.success) {
          let n = new bootstrap.Modal(document.getElementById("feedback"));
          n.show(), e.reset(), e.classList.remove("was-validated");
        } else throw Error(o.message || "Error desconocido");
      } catch (s) {
        console.error("Error:", s),
          alert(`Error al enviar el formulario: ${s.message}`);
      }
    },
    !1
  );
});
let date = new Date(),
  time = d.createElement("time"),
  text = d.querySelector(".copy-text"),
  year = date.getFullYear();
time.classList.add("copy-time"),
  (text.textContent = "Copyright \xa9 "),
  (time.textContent = year),
  time.setAttribute("datetime", year),
  text.appendChild(time);
const daysMap = {
  LUNES: { tabId: "nav-monday-tab", contentId: "nav-monday" },
  MARTES: { tabId: "nav-tuesday-tab", contentId: "nav-tuesday" },
  MIERCOLES: { tabId: "nav-wednesday-tab", contentId: "nav-wednesday" },
  JUEVES: { tabId: "nav-thursday-tab", contentId: "nav-thursday" },
  VIERNES: { tabId: "nav-friday-tab", contentId: "nav-friday" },
  SABADO: { tabId: "nav-saturday-tab", contentId: "nav-saturday" },
};
function setActiveTab() {
  let e = new Date().getDay(),
    t;
  switch (e) {
    case 0:
    case 1:
      t = "LUNES";
      break;
    case 2:
      t = "MARTES";
      break;
    case 3:
      t = "MIERCOLES";
      break;
    case 4:
      t = "JUEVES";
      break;
    case 5:
      t = "VIERNES";
      break;
    case 6:
      t = "SABADO";
  }
  d.querySelectorAll(".nav-link").forEach((e) => {
    e.classList.remove("active"), e.setAttribute("aria-selected", "false");
  }),
    d.querySelectorAll(".tab-pane").forEach((e) => {
      e.classList.remove("show", "active");
    });
  let a = daysMap[t],
    r = d.getElementById(a.tabId),
    l = d.getElementById(a.contentId);
  r &&
    l &&
    (r.classList.add("active"),
    r.setAttribute("aria-selected", "true"),
    l.classList.add("show", "active"));
}
async function fetchSheetData() {
  try {
    let e = await fetch("/api.php");
    if (!e.ok) throw Error("Network response was not ok " + e.statusText);
    let t = await e.json();
    Object.values(daysMap).forEach(({ contentId: e }) => {
      let t = d.querySelector(`#${e} .tab-wrapper`);
      t && (t.innerHTML = "");
    });
    let a = t.values,
      r = a[0].map((e) => e.toUpperCase()),
      l = a.slice(1);
    l.forEach((e) => {
      let t = e[0];
      r.slice(1).forEach((a, r) => {
        let l = e[r + 1];
        if (l && daysMap[a]) {
          let o = d.querySelector(`#${daysMap[a].contentId} .tab-wrapper`);
          if (o) {
            let n = d.createElement("div");
            n.classList.add(
              "single-box",
              "col-sm-6",
              "col-md-4",
              "col-lg-3",
              "mb-2"
            ),
              (n.innerHTML = `
            <div class="px-2 w-100">
                          <div class="single-caption text-center">
                              <div class="caption">
                                  <span>${t}</span>
                                  <h3>${l}</h3>
                              </div>
                          </div>
                          </div>`),
              o.appendChild(n);
          }
        }
      });
    }),
      setActiveTab();
  } catch (o) {
    console.error("Error fetching data:", o);
  }
}
("horarios-y-tarifas.php" === page || "horarios-y-tarifas" === page) &&
  fetchSheetData(),
  d.addEventListener("DOMContentLoaded", () => {
    let e = new URLSearchParams(window.location.search);
    if (e.has("message") && ("contacto.php" === page || "contacto" === page)) {
      let t = d.getElementById("form-scroll");
      console.log(t),
        t &&
          ((t.style.scrollMargin = "7rem"),
          t.scrollIntoView({ behavior: "smooth", top: 80 }));
    }
  });
const opciones = { day: "numeric", month: "long", year: "numeric" },
  footerBlog = d.querySelector(".footer-blog");
dynamicGallery.forEach((e) => {
  if ("instagram" !== e.type) {
    let t = new Date(e.date),
      a = d.createElement("a"),
      r = d.createElement("h3"),
      l = d.createElement("time"),
      o = d.createElement("span");
    a.classList.add("fb-item"),
      (a.href = e.link),
      (r.textContent = e.title),
      (l.dateTime = t),
      o.classList.add("blog-time"),
      (l.innerText = t.toLocaleDateString("es-ES", opciones)),
      o.appendChild(l),
      a.appendChild(r),
      a.appendChild(o),
      footerBlog.appendChild(a);
  }
}),
  document.addEventListener("DOMContentLoaded", function () {
    let e = document.createElement("div");
    document.body.insertBefore(e, document.body.firstChild);
    let t = new MutationObserver((e) => {
      e.forEach((e) => {
        e.addedNodes.length &&
          e.addedNodes.forEach((e) => {
            e.classList &&
              e.classList.contains("cl-consent-node-p") &&
              requestAnimationFrame(() => {
                e.classList.add("loaded");
              });
          });
      });
    });
    t.observe(document.body, { childList: !0, subtree: !0 }),
      window.addEventListener(
        "pagehide",
        () => {
          t.disconnect();
        },
        { once: !0 }
      );
  });
